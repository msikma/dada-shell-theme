#!/usr/bin/env fish

set err "backup-files: Error:"
set src ~/"Files/Music/"
set dst "/Volumes/Files/Backups/$hostname/Files/Music/"

if not set -q hostname
  echo "$err \$hostname is not set"
  exit 1
end

if not test -d $src
  echo "$err Can't access source directory: $src"
  exit 1
end

if not test -d $dst
  echo "$err Can't access target directory: $dst"
  exit 1
end

rsync -ahvrESH8 --delete --progress --stats --exclude=".*/" --exclude=".*" $src $dst

mkdir -p ~/.cache/dada
echo (date +"%a, %b %d %Y %X %z") > ~/.cache/dada/backup-music
